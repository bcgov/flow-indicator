---
topic: "water"
title: "Long-Term Trends in River Flows in B.C."
output: envreportutils.internal::print_ver
---
<!--
Copyright 2024 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

```{r setup, echo = FALSE, warning = FALSE, message = FALSE, cache = FALSE, results = 'hide'}

library(dplyr)
library(ggplot2)
library(grid)
library(RColorBrewer)
library(scales)
library(bcgroundwater)
library(envreportutils)
library(gridExtra)
library(xtable)
library(lubridate)
library(forcats)
library(here)
library(magick)
library(png)
library(cowplot)
library(here)
library(sf)

knitr::opts_chunk$set(cache = FALSE)

theme_set(theme_classic() +
            theme(text = element_text(colour = "black"),
                  axis.line = element_blank(),
                  axis.ticks = element_blank(),
                  panel.grid.major = element_line(colour = "grey85", size = 0.5,
                                                linetype = 1),
                  panel.grid.minor = element_line(colour = "grey90", size = 0.5,
                                                linetype = 1),
                  panel.grid.major.x = element_blank(),
                  panel.spacing = unit(0.6, "lines"),
                  plot.title = element_text(vjust = 2, hjust = 0.5),
                  axis.title = element_text(vjust = 0.1),
                  legend.position = "bottom", legend.title = element_blank(),
                  legend.text = element_text(size = 12),
                  axis.text.x = element_blank(),
                  strip.background = element_blank()))

label.colour <- "black" 
colour.scale <- brewer.pal(3,"Blues")

annual_flow_dat = readRDS(here("app/www","annual_flow_dat_buffer30.rds"))
stations_sf = st_read(here("app/www","stations.gpkg"))

load(here("print_ver/out","figures.Rdata"))
```

Changes in the timing and volume of river flow can affect both natural ecosystems and human 
communities - they can affect our ability to predict and manage seasonal water resources and
flood risks, and may impact natural systems that rely on natural flow patterns. Low river flows
in summer may reduce the amount of water available for agriculture, hydroelectric power generation,
industry and communities. Low river flows are also associated with declines in water quality and 
warmer water temperatures which can threaten the health of aquatic ecosystems. The indicator measures
several metrics representing river flow at `r nrow(stations_sf)` stations across the Province. These stations
have been monitored for a minimum of `r min(stations_sf$N_Years)` years and a maximum of `r max(stations_sf$N_Years)` years between `r min(stations_sf$Min_Year)` and `r max(stations_sf$Max_Year`.

# Metrics

## Average annual flow

## Date and volume of low flow

## Date and volume of peak flow

## Date of Freshet

Freshet is defined as the flood of a river, often due to heavy rain or snow melt. For this analysis, we define date of freshet as the date whereby 50% of river flow for that water year has taken place. 

```{r fig.width = 10, fig.height = 8, echo = FALSE}
mk_all
```

The metrics measured at each station can be broken down into two types: change in the magnitude of river flow and change in the timing of river flow. Magnitude of flow across all stations has increase in terms of both low and peak flows. Average annual flow has increased and decreased at certain stations, but in general the pattern seems to be a similar volume of flow. The timing of events related to river flow, such as date of freshet and date of low flow, are happening earlier at a large number of rivers. 

Of the `r nrow(stations_sf)` stations monitored across the Province, 

# Changes in magnitude of river flow

## Average annual flow
```{r fig.width = 10, fig.height=8, echo = FALSE}
annual_bar
```

## Peak flow
```{r fig.width = 10, fig.height=8, echo = FALSE}
peak_bar
```

## Low flow
```{r fig.width = 10, fig.height=8, echo = FALSE}
low_bar
```

# Changes in timing of river flow

## Date of freshet
```{r fig.width = 10, fig.height=8, echo = FALSE}
freshet_bar
```

## Date of low flow
```{r fig.width = 10, fig.height=8, echo = FALSE}
date_low_bar
```
